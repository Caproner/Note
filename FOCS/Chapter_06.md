# 第六章 计算机网络和因特网

本章主要讨论计算机网络相关的基础知识。

## 计算机网络基础

### 基础概念

+ 局域网：将主机连接起来的私有网络
+ 广域网：将交换机或路由器等连接起来的网络。其比局域网覆盖范围更大（局域网一般范围就是一个学校，一个组织这样的，而广域网的范围可以到一座城市，一个国家）
+ 互联网：通过局域网和广域网将设备连起来构成的互联网络，或者说是网际网（也就是网络的网络）
+ 因特网：目前最大的互联网络。由骨干网，因特网服务供应商网络（ISP）和客户网络三级组成。

### 协议分层

首先，互联网之间的信息传递肯定不是明文的（也传不了明文），所以需要通过双方约定好传输格式以及其他细则之后就可以通过传二进制数据的方式来互传信息了，这个约定好的东西就是**协议**。

而协议分层指的是不只靠一个协议而是通过多个协议将信息一层层加密/解密。每一层的协议的关注点都是不同的，例如说有的协议关注数据的完整校验，有的协议关注数据的信息加密，有的协议关注数据如何转化为物理信号等。其实就是模块化思想。

协议层之间可以忽略掉更底层的协议而看作是直接连接的（就结果而言看起来的确很像是直接连接的），例如从最终效果上看，网络连接的确就是可以将明文传输过去的。这种假想的连接叫做**逻辑连接**。

协议分层的两个原则是：

+ 每个协议层都可以做两个对立的工作，例如说加密和解密，发送和接收等
+ 在通信的两端中，两个协议层之间的产物一定要格式一样的，例如说电子数据，密文，明文等

### TCP/IP协议族

这是一种协议分层的形式，也是目前用的最多的一种。

TCP/IP协议族采用五层分层方式，自上而下分别是应用层，传输层，网络层，数据链路层和物理层。

一般源和目标会涉及到这五层的加密和解析，而作为中间件的交换机（只有两层）和路由器（只有三层）则不会有完整的五层加密解密（因为他们不需要关注太多的上层信息）。

一个值得一提的东西是**地址**，不管是在哪一层我们都需要一个地址才能知道对方的对应层的地址：

+ 在应用层下，我们需要知道对方的名称，例如说邮箱，网址，或者请求串等
+ 在传输层下，我们需要知道对方的端口号
+ 在网络层下，我们需要知道对方的逻辑地址（一般就是IP地址）
+ 在数据链路层下，我们需要知道对方的链路层地址（也就是MAC地址）
+ 在物理层下的传输数据单位是位，故不需要也无法使用地址，传就是了。

## 应用层

应用层是最上面一层的协议。它不需要给其他层提供服务，只接收传输层提供的服务。这意味着应用层的协议可以轻易去掉换成别的协议。

在应用层的层面上看，两台机器之间的通信就是直接相连然后通信。

### 应用层模式

应用层模式需要解决的问题就是，在已知机器可以连接的情况下，机器之间应该如何交互。

于是就有两种模式：C/S模式和P2P模式。

+ C/S模式：客户端-服务端模式。两台机器的交互借由中间的服务端机器完成。
+ P2P模式：端对端模式。两台机器直接交互。

### 应用层程序列举

这里简单介绍一些常见的应用层程序/协议。

#### 万维网/超文本传输协议

万维网和超文本传输解决的问题是让用户可以通过访问特定站点来获取多媒体页面（也就是网页）。

样式丰富的多媒体页面是通过**超文本**（HyperText）达到效果的。说白了就是可以引用其他资源的简单样式语言（HTML）。

而这些提供服务的站点（机器）就组成了万维网。

客户端通过统一资源定位器（URL）发出从目标站点获取指定超文本的请求，服务器根据URL返回超文本给客户端，客户端收到超文本后通过解释器（浏览器）解析并显示出来，这就是访问一个网页的大致过程。

而在这之中使用的传输协议就是**超文本传输协议（HTTP）**。其默认使用80端口。

#### 文件传输协议

也就是FTP，其通过FTP服务器实现文件的上传/下载。

其包括**控制连接**和**数据传输连接**。控制连接会在整个FTP会话中一直处于开启状态，而数据传输连接只会在收到上传/下载命令时才开启，并在文件传输结束后关闭。

命令和数据分开传输使得其效率上升。

#### 电子邮件

收发电子邮件同样需要依靠服务器。

假设用户A要给用户B发送一封邮件。其大致过程是：

+ 用户A通过**用户代理端（UA）**将邮件发送出去，此时邮件到达**本地的信息传送代理（MTA）客户端**
+ **本地的MTA客户端**将邮件发给**用户A所属的邮件服务器的MTA服务端**
+ 邮件服务器中会有一个队列，用于将**MTA服务端**的邮件推往**MTA客户端**
+ **邮件服务器的MTA客户端**会将邮件发送至**目标用户（也就是用户B）所属的邮件服务器的MTA服务端**
+ **邮件服务器的MTA服务端**在收到外部发来的邮件时会将其放入**邮箱**中
+ 当用户B需要拉取邮件时，其**邮件服务器的信息访问代理（MAA）服务端**会从**邮箱**中拉取邮件发送至**用户B的MAA客户端**
+ 用户B通过其**UA**读取**MAA客户端**的邮件

#### TELNET

简单啊的讲就是，TELNET协议用于用户从客户端直接登录目标服务端并对其操作，也就是**远程登录**。

但其传输方式是明文传输，故几乎没有安全性可言，后续逐步被SSH取代。

#### 安全外壳

也就是SSH，更安全的远程登录协议。

SSH有两个版本：SSH-1和SSH-2，SSH-1已经因为其安全漏洞被弃用，现在用的是SSH-2。

#### 域名系统

也就是DNS。可以理解为给用户可以用域名换目标IP的系统。

其本质就是一系列的DNS服务器。既包括本地的DNS缓存，也包括远程的根据命名空间区分的DNS服务器。

## 传输层

传输层位于应用层和网络层之间，也是TCP/IP协议族的核心部分。

在这一层上看，两台通信的机器仍旧是直接相连的。

严格地讲，在传输层的层面上不是两台机器进行通信，而是**两个进程进行远程通信**。网络层负责把数据送到对应的机器，但是至于数据要给哪个进程，这就是传输层协议的工作了。

其一般通过**让进程绑定端口号**的方式使得进程间通信转化为端口间通信。

### 传输层协议

常见的有UDP和TCP

#### 用户数据报协议（UDP）

这个协议仅仅是给要发送的数据加个头而已。其是无连接的不可靠协议（也就是只管发不管到），但其相对TCP而言更加轻量级，其极其简单且开销很低，很适合用于信息实时同步等场景。

UDP发送的包也叫做**用户数据报**

#### 传输控制协议（TCP）

相对于UDP而言，TCP是一个面向连接的可靠协议。它的头包含更多的数据，其也有着一套复杂的传输控制规则。

TCP发送的包也叫做**段**

## 网络层

不同于前面两层，网络层层面上的连接并不是两台机器直接相连，而是其中间会隔着许多的路由。数据包会从源机器开始，经过若干个路由之后才会到达目标机器。

对于网络层而言，数据的传输就是机器对机器的传输。这里的机器包括任何带IP地址的机器，例如电脑或路由。

网络层需要根据其使用的协议对数据再加一个头，这个头会包含一些传输需要的信息（例如源IP，目标IP，下一站的IP等）。

其数据包的传输有如下特点：

+ 不可靠传递：其传输过程中的任何损坏，丢失，重复，都不归网络层管。
+ 无连接传递：就只是将包扔给目标（更准确的说是下一站）。
+ 不保证顺序：由于传输途中一般不会只有一条路径，故从源机器发送的多个数据包到目标机器的顺序很可能不会是原来的顺序（有的走的快有的走的慢）。将乱序的数据包组合起来是传输层的工作。

### 网络层协议

主要有IPv4和IPv6两个。

其主要区别也就是地址格式不同，以及因此带来的数据包的头部不同。

## 数据链路层

数据链路层是节点对节点的连接。

其数据的传输单位为帧，可以理解为将切分后的数据再加个头和尾。

数据链路层的数据传输会经过局域网（LAN）和广域网（WAN）。

## 物理层

物理层虽然也是节点对节点的连接，但是其传输的单位是位，也就是最原始的逻辑数据。

在物理层中，数据以信号表示。其可以是**模拟信号**和**数字信号**。

> 模拟信号更像是波的信号，属于连续的信息，而数字信号的信息则是离散的。

于是传输也分为两种：数字化传输和模拟传输。

+ 数字化传输：传输信号为数字信号的传输。其可以是数数转换（数位转换为数字信号传输），或者是模数转换（模拟信号采样形成数位，数位转换为数字信号，到目标时再将数位连接回模拟信号）。
+ 模拟传输：传输信号位模拟信号的传输。其可以是数模转换（数位转换为模拟信号传输），或者是模模转换（将模拟信号转换成更加有利于传输的模拟信号）

### 物理层的传输介质

其传输介质可以分为导向介质和非导向介质两种。

+ 导向介质：也就是有提供导向性物理通道的介质。例如说双绞线，同轴电缆，光纤电缆。
+ 非导向介质：也就是无线传输。其主要利用无线电波，微波或红外波进行在空气等非导向介质中传播。