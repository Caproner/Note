# 第四章 数据运算

本章主要讨论如下内容：

+ 逻辑运算
+ 移位运算
+ 算术运算

## 逻辑运算

### 位层次上的逻辑运算

这里仅讨论单个位下的逻辑运算。

逻辑运算包括与（and），或（or），非（not），异或（xor）这四种。其中除了非为一元运算符之外其他都是二元运算符。

与运算当且仅当两个位均为1时才为1，否则为0。

或运算当且仅当两个位均为0时才为0，否则为1。

非运算即为取反，当位为0时则结果为1，否则则为0。

异或运算可以理解为判断两者择一的运算，当且仅当两个位不同时为1，否则为0。

### 模式层次上的逻辑运算

这里将单位运算扩展到多个位的情况，其实就是逐位计算一遍即可。

这里仅讨论其运用。

#### 使指定的位复位

可以使用`and`运算符将某个数字指定的位置为0。

例如说，我们需要将一个8位数字的低4位置零，那么只需要将这个数字与二进制数字`11110000`做`and`运算即可。

这样的话跟0做与运算的位肯定就是会变为0，而与1做与运算的位肯定就还会保持原状，于是就能达到低4位置零的效果了。

这个时候像上面`11110000`这样的二进制数字就被称为**掩码**。

#### 使指定的位置位

也就是让指定的位置为1。这个只需要参考上面的操作，然后用或运算来解决即可。

#### 使指定的位反转

这个需要用到异或运算。

异或运算有一个特性就是，让某个位跟1进行异或运算则可以让其反转：`0 xor 1 = 1, 1 xor 1 = 0`

利用这个特性，再结合上面的操作就可以让指定的位反转了。

## 移位运算

顾名思义地，移位运算就是让整个位模式向左或向右移动。

那么移位就会涉及到两个问题：

+ 被挤出去的位去了哪里
+ 空出来的位要填啥

根据这两个问题的解决策略就可以分为逻辑移位，循环移位，算术移位这三种。

### 逻辑移位

在逻辑移位中，不管是左移还是右移，被挤出去的位默认舍弃，空出来的位默认填零。

举个例子，在8位数位的情况下对`10111011`进行左移3位，则高位的`101`被舍弃，低位三个空位默认填零，于是答案就是`11011000`

### 循环移位

循环移位的核心思想就是不抛弃挤出去的位，而将挤出去的位填补到空出来的位置中。

就相当于整个数字的链围成一个圈这样子。

举个例子，还是在8位数位的情况下对`10111011`进行左移3位，则高位的`101`会被填补在低位空出来的三位中，于是答案就是`11011101`

### 算术移位

在算术移位中，移位操作用于在**带符号的二进制补码**中作为乘以2和除以2的运算存在。

在这里，算术左移一位则是乘以2，算术右移一位则是除以2。

于是其核心思想就是**在保持符号位不变的情况下，左移或者右移**

#### 算术左移

算术左移达到的目的就是乘以2。

故在算术左移中，数字直接按位左移，高位舍弃，低位置零。也就是跟逻辑左移一致。

那么这样就会有两种情况：

+ 符号位在移位前后保持不变，则此时数字位就是一次正常的左移，达到乘以2的效果。
+ 符号位在移位前后发生改变，则表示原数字在乘以2之后无法存储进来，于是发生溢出。

#### 算术右移

算术右移达到的目的就是除以2。

但其又不能让最高位填0（不然假设当前是负数的话符号位就变了，这不符合目的），于是就需要**复制之前的最高位（也就是符号位）用来填右移后的最高位**。

当然，挤出去的低位就是要舍弃掉的。

## 算术运算

算术运算包括加减乘除，根据数据存储方式的不同又分为整数算术运算和实数算术运算

### 整数算术运算

限于篇幅，这里没有讨论整数乘除法运算，仅讨论了整数加减法。

> 不愧是导论，啥都说但啥都没说深= =
>
> 我想乘除法应该是要等计组开坑了才会学到了

#### 二进制补码的加减法

首先是加法，由于其设计的优越性使得其二进制对应的数字是**连续的**，故只需要按位相加就行，记得**进位**。

而减法其实就是加上原本的数字取负，在二进制补码中只需要对原来的数字取补码（也就是取反再加一）即可。

#### 符号加绝对值的加减法

**这个就麻烦了**。

首先将减法去掉，减法等于加上原本数字取负，故如果是减法的话需要对第二个数字的符号位反转一下。

然后就是判断符号位是否相同了，这个可以用异或运算搞定。

+ 符号相同：那数字位直接相加就可以了。但有可能会发生上溢，需要注意。
+ 符号不同：那么结果的符号肯定就是比较大的那个的符号了。而运算过程就很麻烦了。
  + 首先，对第二个数字的数值位取补码
  + 然后，令两个数字相加
  + 这个时候观察有没有溢出，如果有的话表示第一个数比较大，符号位沿用第一个数字的
  + 如果没有溢出则说明第二个数字比较大，此时符号位沿用第二个的，而且还需要对数值位的计算结果再取一次补码

### 实数算术运算

这里当然也只会讨论其加减运算。

**当然它也很麻烦**。

+ 排除减法。如果是减法的话将第二个数的符号位取反，并变成加法。

+ 对0进行特殊讨论，当参与计算的两个数字中存在0的时候就直接取另一个数字作为运算结果
+ 去规范化，将两个数字还原为科学计数法表示形式
+ 对齐，通过左移或右移尾数来让两个数字的指数相等（注意尾数不要上溢，可以允许下溢只不过这就会出现截断误差）
+ 带上符号位的尾数相加，这个就是**符号加绝对值的加减法**了。
+ 将结果规范化。